<!DOCTYPE html>
<html lang="en" xmlns:color="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title>User page</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link href="https://fonts.googleapis.com/css?family=Amiko" rel="stylesheet">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
</head>


<style>
    .modal {
    display: none; /* Hidden by default */
    position: fixed; /* Stay in place */
    left: 0;
    top: 0;
    width: 100%; /* Full width */
    height: 100%; /* Full height */
    overflow: auto; /* Enable scroll if needed */
    background-color: rgb(0,0,0); /* Fallback color */
    background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
    }
    /*  Content */
    .modal-content {
    background-color: lightcyan;
    color: #777;
    margin: auto;
    padding: 20px;
    padding-bottom: 10%;
    border: 1px solid #888;
    width: 80%;
    height: auto;
    -webkit-animation-name: fadeIn;
    -webkit-animation-duration: 0.6s;
    animation-name: fadeIn;
    animation-duration: 0.6s
    }
    /* Add Animation */
    @-webkit-keyframes fadeIn {
    from {opacity: 0}
    to {opacity: 1}
    }
    @keyframes fadeIn {
    from {opacity: 0}
    to {opacity: 1}
    }

    body {
        background-color: lightcyan;
        margin: 0 auto;
    }

    .upperbtn {
        background-color: #4DB6AC;
        border-radius: 4px;
        color: white;
        float:left;
        width: 120px;
        height: 30px;
        padding: 5px 5px;
        margin: 8px 0;
        border: none;
        cursor: pointer;
    }

    .upperbtn:hover{
    color: #CFD8DC;
    box-shadow: 0 4px 6px 0 rgba(0,0,0,0.24), 0 8px 20px 0 rgba(0,0,0,0.19);
    transition: box-shadow 1s,text-shadow 1s,color 1s;
    }

    #upperlevel {
    width: 100%;
    height: 200px;
    text-align: center;
    }

    #imgcontainer {
    position:relative;
    margin-left:auto;
    margin-right: auto;
    width: 400px;
    height:200px;
    }

    img.logo {
    display: block;
    margin-left: auto;
    margin-right: auto
    }

    #greeting_box{
    text-align: center;
    color:black;
    font-size:45px;
    font-family:Impact,serif;
    bottom:0;
    }

    #middle {
    text-align: center;
    width: 100%;
    height:500px;
    margin: 20px auto;
    }

    #middleblock_left{
    /*background-color:rgba(3, 155, 229,0.5);*/
    margin-left:20px;
    margin-right:20px;
    padding:20px 60px;
    text-align: center;
    height:100%;
    width: 31%;
    border: 1px solid rgba(0,0,0,0.08);
    font-family:"RooneySans-Bold", "Lucida Grande", "Lucida Sans Unicode", "Trebuchet MS", sans-serif;
    float:left;
    }

    #middleblock_mid{
    /*background-color:rgba(3, 155, 229,0.5);*/
    float:left;
    text-align: center;
    height:100%;
    width: 31%;
    padding:20px 100px;
    border: 1px solid rgba(0,0,0,0.08);
    }

    #middleblock_right{
    /*background-color:rgba(3, 155, 229,0.5);*/
    margin-left:20px;
    margin-right:20px;
    padding:20px 100px;
    text-align: center;
    height:100%;
    width: 32%;
    border: 1px solid rgba(0,0,0,0.08);
    float:left;
    }

    .mid_titles{
    color: #777;
    font-size:30px;
    font-weight: bold;
    font-family:"Amiko",sans-serif;
    }

    #footer{
    margin: 5px auto;
    bottom:0;
    width:100%;
    position:relative;
    }

    /*#usersection {*/
    /*width: 240px;*/
    /*height: 123px;*/
    /*float: right;*/
    /*}*/
    #changeBtn1 {
    margin-top: 80px;
    margin-bottom:20px;
    color:white;
    background-color:#4DB6AC;
    border: hidden;
    display: inline-block;
    transition: all 0.5s;
    cursor: pointer;
    }

    #changeBtn1 span{
    cursor:pointer;
    display: inline-block;
    position:relative;
    transition:0.5s;
    }

    #changeBtn1 span:after {
    content: '»';
    position: absolute;
    opacity: 0;
    top: 0;
    right: -10%;
    transition: 0.5s;
    }

    #changeBtn1:hover span {
    padding-right: 15px;
    }

    #changeBtn1:hover span:after {
    opacity: 1;
    right: 0;
    }

    #changeBtn2 {
    margin-top:40px;
    color:white;
    background-color:#4DB6AC;
    border: hidden;
    display: inline-block;
    transition: all 0.5s;
    cursor: pointer;
    }

    #changeBtn2 span{
    cursor:pointer;
    display: inline-block;
    position:relative;
    transition:0.5s;
    }

    #changeBtn2 span:after {
    content: '»';
    position: absolute;
    opacity: 0;
    top: 0;
    right: -10%;
    transition: 0.5s;
    }

    #changeBtn2:hover span {
    padding-right: 15px;
    }

    #changeBtn2:hover span:after {
    opacity: 1;
    right: 0;
    }

    #back-top {
    position: fixed;
    display:none;
    font-size: 50px;
    color: rgba(0,0,0,0.5);
    bottom: 5px;
    right:30px;
    width:auto;
    }

    a#back-top:active {
    background:none;
    }

    a#back-top {
    display: block; text-decoration: none;
    }

    .topup {
    bottom:5px;
    }

    #back-top i {
    display: block;
    }


    table{
    margin-top: 20%;
    color: #777;
    font-size:20px;
    width:100%;
    }

    td{
    text-align: left;
    padding-top:0.5em;
    padding-bottom: 0.5em;
    }

    ol span{
        position:relative;
        text-decoration: none;
        font-size: 20px;
        font-family: "Amiko", sans-serif;
        cursor:pointer;


    }
    ol span:hover{
        color:black;
        transition: color 1s;
    }

    ol span:before{
        content:"";
        position: absolute;
        width: 100%;
        height: 2px;
        bottom: 0;
        left: 0;
        background-color: #000;
        visibility: hidden;
        -webkit-transform: scaleX(0);
        transform: scaleX(0);
        -webkit-transition: all 0.3s ease-in-out 0s;
        transition: all 0.3s ease-in-out 0s;
    }

    ol span:hover:before{
        visibility: visible;
        -webkit-transform: scaleX(1);
        transform: scaleX(1);
    }


    .lines{
    border-top: 1px #9E9E9E solid;
    }

    @media only screen and (max-width: 479px){
    div { width: 90%; }
    }
</style>

<body>

<div id="upperlevel">

    <button class="upperbtn" type="button" id="homebtn">
        <span class="glyphicon glyphicon-home"></span> Home
    </button>

    <div id = "imgcontainer">
        <img class="logo" src="logo4.png" alt="logo"  style="
        width: 240px;
        height: 200px;
        ">
    </div >


</div>



<div id = "middle">

    <div id ="middleblock_left">

        <span class="glyphicon glyphicon-user" style="
        color: #777;
        font-size:30px;
        font-weight: bold;
        "></span>
        <span class="mid_titles">
            Account
        </span>

        <table>
            <tr>
                <td id="userID"></td>
            </tr>

            <tr class="lines">
                <td>Email:</td>
            </tr>
            <tr id="email"style="text-align: left"></tr>

            <tr class="lines">
                <td>Authority:</td>
            </tr>
            <tr id="Aut" style="text-align: left"></tr>
        </table>
    </div>

    <div id ="middleblock_mid">
        <div id="tmp" style="width: 100%">
        <span class="glyphicon glyphicon-cog" style="
        color: #777;
        font-size:30px;
        font-weight: bold;
        "></span>
        <span class = "mid_titles">
            Setting
        </span>
        </div>


        <button type="button" class="btn btn-default btn-lg" id ="changeBtn1" style="font-size: 14px">
            <span class="glyphicon glyphicon-lock"></span> Change your password
        </button><br>

        <button type="button" class="btn btn-default btn-lg" id = "changeBtn2" style="font-size: 14px">
            <span class="glyphicon glyphicon-envelope"></span> Change your Email
        </button>

        <!--<a href="/ChangeEmail" target="_blamk">-->
        <!--Change your Email-->
        <!--</a>-->

    </div>

    <div id ="middleblock_right">
        <span class="glyphicon glyphicon-list-alt" style="
        color: #777;
        font-size:30px;
        font-weight: bold;
        "></span>
        <span class="mid_titles">
            Article
        </span>


        <!--<h1 style="color: #fefefe;margin-top: 1.5cm;font-size: large">Articles</h1>-->
        <h2 id="Artical" style="color: #fefefe;margin-top: 1.5cm;font-size: large"></h2>
        <ol id="articles" style="color:#777; text-align: left; font-size:16px">
        </ol>
    </div>

    <div class="modal" id="my-modify-modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-content" style="width: 800px;height:auto;margin-left: auto;margin-right: auto;margin-top: 120px;">
            <div class="modal-body">
                <span id="closebtn" class="close">CLOSE</span>
                <div class="clearfix"></div>
                <div  class="modify-content">
                    <h2 id="titleH2" style="text-align: center;"></h2>
                    <h5 id="authorH3" style="text-align: center;"></h5>
                    <div id="textArea" style="text-align: left;"></div>
                </div>

                <div class="clearfix"></div>
            </div>
        </div>
    </div>

    <div class="modal" id="my-modify-modal2" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-content" style="width: 500px;height:200px;margin-left: auto;margin-right: auto;margin-top: 120px;">
            <div class="modal-body">
                <span id="closebtn2" class="close">CLOSE</span>
                <div class="clearfix"></div>
                <div  class="modify-content">
                    <div class="container">
                        <div class="input-group" style="margin-bottom: 10px; width: 400px">
                            <span class="input-group-addon">Enter</span>
                            <input type="text" class="form-control" id="newpassword" placeholder="Enter New Password">
                        </div>
                        <div class="input-group" style="margin-bottom: 10px; width: 400px">
                            <span class="input-group-addon">Confirm</span>
                            <input type="text" class="form-control" id="newpassword2" placeholder="Re-enter New Password">
                        </div>
                     </div>
                    <button type="button" class="btn btn-default btn-lg" id = "submitchangePwd" onclick="checkpwd()">
                        <span class="glyphicon glyphicon-ok"></span> Submit Change
                    </button>
                </div>

                <div class="clearfix"></div>
            </div>
        </div>
    </div>

    <div class="modal" id="my-modify-modal3" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-content" style="width: 500px;height:150px;margin-left: auto;margin-right: auto;margin-top: 120px;">
            <div class="modal-body">
                <span id="closebtn3" class="close">CLOSE</span>
                <div class="clearfix"></div>
                <div  class="modify-content">
                    <div class="container">
                        <div class="input-group" style="margin-bottom: 10px; width: 400px">
                            <span class="input-group-addon">New Email</span>
                            <input type="text" class="form-control" id="newEmail" placeholder="Enter New Email Address">
                        </div>
                    </div>
                    <button type="button" class="btn btn-default btn-lg" id = "submitchangeEmail" onclick="checkemail()">
                        <span class="glyphicon glyphicon-ok"></span> Submit Change
                    </button>
                </div>

                <div class="clearfix"></div>
            </div>
        </div>
    </div>

</div>

<div id="footer" >

    <!--<div style="margin-left: 90%">-->
    <!--<a href="#top">-->
    <!--<img border="0" src="up_arrow.png" />-->
    <!--</a>-->
    <!--</div>-->
    <a href="#top" id="back-top"><span class="glyphicon glyphicon-eject"></span></a>

</div>


</body>

<script>
    function add(){
        window.location.replace('/ModePage');
    }
</script>

<script src="http://code.jquery.com/jquery-latest.js"></script>
<script>
    var flag = 1;
    function getCookie(c_name)
    {
        if (document.cookie.length>0)
        {
            c_start=document.cookie.indexOf(c_name + "=")
            if (c_start!=-1)
            {
                c_start=c_start + c_name.length+1
                c_end=document.cookie.indexOf(";",c_start)
                if (c_end==-1) c_end=document.cookie.length
                return unescape(document.cookie.substring(c_start,c_end))
            }
        }
        return ""
    }
    console.log("000000");
    var username = getCookie('username');
    console.log(username);
//    var userbtn = document.getElementById('userbtn');
//    if (username != "") {
//        userbtn.appendChild(document.createTextNode('welcome '));
//        userbtn.appendChild(document.crea teTextNode(username));
//    } else {
//        userbtn.appendChild(document.createTextNode('Login'));
//    }
//    var greeting = document.getElementById('greeting_box');
//    if (greeting != "") {
//
//        greeting.appendChild(document.createTextNode(username));
//        greeting.appendChild(document.createTextNode('!'));
//    }
    //--
    var g;
    var res;
    var obj2 = {};
    obj2.username = username;
    $(function(callback) {
        res = $.ajax({
            url: '/UserPage',
            type: 'POST',
            dataType: 'json',
            data: JSON.stringify(obj2),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                callback(data);
            },
            error: function (error) {
                console.log(error);
            }
        })
        var res = res.done(function(result) {
            console.log(res.responseText);
            var obj = JSON.parse(res.responseText);
            //document.getElementById("id").innerHTML=obj.username
            document.getElementById("userID").innerHTML = "ID: "+obj.id;
            document.getElementById("email").innerHTML = obj.email
            if(obj.authority == 0) {
                document.getElementById("Aut").innerHTML = "User";
            }
            else if(obj.authority == 1) {
                flag =1;
                document.getElementById("Aut").innerHTML = "Certified user";
            }
            else if(obj.authority == 2) {
                document.getElementById("Aut").innerHTML = "Admin";
            }
        });
    });
    $(document).ready(function(){
        $("h1").delay("1000").fadeIn();
        // hide #back-top first
        $("#back-top").hide();
        // fade in #back-top
        $(function () {
            $(window).scroll(function () {
                if ($(this).scrollTop() > 50) {
                    $('#back-top').fadeIn();
                } else {
                    $('#back-top').fadeOut();
                }
            });
            // scroll body to 0px on click
            $('a#back-top').click(function () {
                $('body,html').animate({
                    scrollTop: 0
                }, 800);
                return false;
            });
        });
        $("#homebtn").click(function() {
            window.location.replace('/ModePage');
        });
        $("#changeBtn1").click(function() {
            var modalChangPwd = document.getElementById("my-modify-modal2");
            modalChangPwd.style.display = "block";
            var span = document.getElementById("closebtn2");
            span.onclick = function() {
                modalChangPwd.style.display = "none";
            }
        });
        $("#changeBtn2").click(function() {
            var modalChangEmail = document.getElementById("my-modify-modal3");
            modalChangEmail.style.display = "block";
            var span = document.getElementById("closebtn3");
            span.onclick = function() {
                modalChangEmail.style.display = "none";
            }
        });
    });
    console.log(flag);
    if(flag==1) {

        var obj3 = {};
        obj3.username = username;
        $(function(callback) {

            res = $.ajax({
                url: '/getArticleByAuthor',
                type: 'POST',
                dataType: 'json',
                data: JSON.stringify(obj3),
                contentType: "application/json; charset=utf-8",
                success: function (data) {
                    callback(data);
                },
                error: function (error) {
                    console.log(error);
                }

            })
            var res = res.done(function(result) {
                var length = result.length;
                for (var a=0; a<length;a++) {
                    console.log(result);

                    var articleList = document.getElementById("articles");

                    var li = document.createElement("li");
                    var span = document.createElement("span");
                    span.value = result[a].content;
                    span.setAttribute("name", result[a].title);
                    span.setAttribute("author", result[a].authorName);
                    span.setAttribute("time", result[a].timeStamp);

                    span.name = result[a].title;
                    span.appendChild(document.createTextNode(result[a].title));

                    li.appendChild(span);
                    li.style.margin = "5px";
                    articleList.appendChild(li);
                    console.log("level3");
                }
                console.log("success9989");
                var modal = document.getElementById("my-modify-modal");

                $("#articles").find("span").click(function() {
                    console.log("success3333");
                    var tagText = $(this).val();
                    console.log("success444");
                    var articleTitle = document.getElementById("titleH2");
                    var articleAuthor = document.getElementById("authorH3");

                    var date = $(this).attr('time');
                    console.log(date);
                    articleTitle.innerHTML = $(this).attr('name');
                    console.log("success555");
                    var minorTitle = date + " " + $(this).attr('author');

                    articleAuthor.innerHTML = minorTitle;
                    var textArea = document.getElementById("textArea");
                    textArea.innerHTML = tagText;
                    modal.style.display = "block";
                });
                var closebtn = document.getElementById("closebtn");
                closebtn.onclick = function() {
                   modal.style.display = "none";
                }
            });
        });
    }
    function checkpwd() {
        var pw1 = document.getElementById("newpassword").value;
        var pw2 = document.getElementById("newpassword2").value;
        if(pw1 !== pw2) {
            alert("New password does not match")
            return;
        }
        if( pw1==0 ||pw2==0) {
            alert("Please Enter your New Password")
            return;
        }
        var obj={};
        obj.username = username;
        var res;
        obj.password = pw2;
        $(function(callback) {
             res = $.ajax({
                 url: '/ChangePassword',
                 type: 'POST',
                 dataType: 'json',
                 data: JSON.stringify(obj),
                 contentType: "application/json; charset=utf-8",
                 success: function (data) {
                     console.log("success!");
                     callback(data);
                 },
                 error: function (error) {
                     console.log(error);
                 }
             })
             var res = res.done(function(result) {
                 console.log(res.responseText);
                 var obj = JSON.parse(res.responseText);

             })
        })
        alert("You have changed your password successfully")
        window.location.replace('/UserPage');
    }
    function checkemail()
    {
        var em = document.getElementById("newEmail").value;
        var obj={};
        obj.email = em;
        obj.username = username;
        $(function(callback) {
            res = $.ajax({
                url: '/ChangeEmail',
                type: 'POST',
                dataType: 'json',
                data: JSON.stringify(obj),
                contentType: "application/json; charset=utf-8",
                success: function (data) {
                    callback(data);
                },
                error: function (error) {
                    console.log(error);
                }
            })

        })
        alert("You have changed your email successfully")
        window.location.replace('/UserPage');
    }
</script>

</html>